<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ receita.titulo }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <main class="container receita-detalhe">
    <a href="{{ url_for('explorar') }}" class="voltar">‚¨Ö Voltar</a>

    <section class="receita-info">
      <h1>{{ receita.titulo }}</h1>
      <img src="{{ url_for('static', filename=receita.imagem) }}" 
           alt="{{ receita.titulo }}"
           width="400" height="300">

      <p><strong>Categoria:</strong> {{ receita.categoria or 'N√£o informada' }}</p>

      {% if receita.utensilios %}
      <p><strong>Utens√≠lios:</strong> {{ receita.utensilios }}</p>
      {% endif %}
    </section>

    <section class="receita-ingredientes">
      <h2>üßÇ Ingredientes</h2>
      <ul>
        {% for ir in receita.ingredientes_receita %}
          <li>{{ ir.quantidade_ingrediente_receita }} {{ ir.ingrediente.nome_ingrediente }}</li>
        {% else %}
          <p>Nenhum ingrediente informado.</p>
        {% endfor %}
      </ul>
    </section>

    <section class="receita-instrucoes">
      <h2>üë©‚Äçüç≥ Modo de preparo</h2>

      {% set etapas = receita.instrucoes.split('.') %}
      <ol>
        {% for etapa in etapas %}
          {% if etapa.strip() %}
            <li>{{ etapa.strip() }}.</li>
          {% endif %}
        {% endfor %}

       <h3>Avalia√ß√µes</h3>

      {% if session.username %}
          {% if receita.usuario.username == session.username %}
              <p>Voc√™ n√£o pode avaliar sua pr√≥pria receita.</p>
          {% else %}
              <form action="{{ url_for('avaliar_receita', id=receita.id) }}" method="POST">
                  <label for="nota">Sua nota:</label>
                  <select name="nota" id="nota" required>
                      <option value="1">‚≠ê 1</option>
                      <option value="2">‚≠ê‚≠ê 2</option>
                      <option value="3">‚≠ê‚≠ê‚≠ê 3</option>
                      <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4</option>
                      <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5</option>
                  </select>

                  <button type="submit">Enviar avalia√ß√£o</button>
              </form>
          {% endif %}
      {% else %}
          <p><a href="{{ url_for('login') }}">Entre</a> para avaliar esta receita.</p>
      {% endif %}

    <hr>

    {% for avaliacao in receita.avaliacoes %}
        <div>
            <strong>{{ avaliacao.usuario.username }}</strong>
            <p>‚≠ê {{ avaliacao.nota }} / 5</p>
            {% if avaliacao.comentario %}
                <p>{{ avaliacao.comentario }}</p>
            {% endif %}
            <small>{{ avaliacao.data_avaliacao.strftime("%d/%m/%Y %H:%M") }}</small>
        </div>
        <hr>
    {% else %}
        <p>Nenhuma avalia√ß√£o ainda. Seja o primeiro!</p>
    {% endfor %}
      </ol>
    </section>
  </main>
</body>
</html>
